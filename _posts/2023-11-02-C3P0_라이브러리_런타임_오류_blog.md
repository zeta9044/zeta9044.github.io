---
layout: post
title: "C3P0 라이브러리 런타임 오류"
date: 2023-11-02
tags: [라이브러리, 오류, 런타임]
categories: blog
---

## 사용자 입력:
> c3p0-0.9.5.5.jar 를 의존성에서 제거했는데, 빌드에서 오류가 없는 소스가 있다. 그런데, runtime에서 오류가 날 수 있나? 

## ChatGPT 응답:
> `c3p0-0.9.5.5.jar`는 Java 데이터베이스 연결을 관리하는 라이브러리인 C3P0의 버전 중 하나입니다. 이 라이브러리는 JDBC(Java Database Connectivity) 데이터 소스의 커넥션 풀링을 위해 널리 사용됩니다.

소스 코드를 빌드할 때 의존성이 제거되었다면, 빌드 프로세스는 해당 라이브러리의 존재를 요구하지 않기 때문에 오류가 발생하지 않을 수 있습니다. 특히, 빌드 과정에서 해당 의존성을 필요로 하는 코드가 실행되거나 컴파일되지 않았다면 빌드 오류는 발생하지 않습니다.

그러나, 런타임에서는 상황이 다릅니다. 프로그램이 실행될 때, `c3p0-0.9.5.5.jar`에 정의된 클래스나 메소드를 사용하는 코드가 실행되면 `ClassNotFoundException`이나 `NoClassDefFoundError` 같은 오류가 발생할 수 있습니다. 이러한 오류는 JVM이 런타임에 필요한 클래스를 찾을 수 없을 때 발생합니다.

따라서, `c3p0-0.9.5.5.jar` 라이브러리를 의존성에서 제거한 경우 다음과 같은 상황에서 런타임 오류가 발생할 수 있습니다:

1. 데이터베이스 커넥션 풀링을 위해 C3P0에 의존하는 코드가 실행될 때.
2. 라이브러리에 정의된 인터페이스나 클래스를 구현하거나 상속하는 코드가 사용될 때.
3. 설정 파일이나 다른 메커니즘이 C3P0의 구성요소를 런타임에 요구할 때.

이 문제를 해결하기 위해서는 다음과 같은 조치를 취할 수 있습니다:

- 만약 C3P0를 사용하지 않기로 결정했다면, 코드에서 모든 C3P0 관련 참조를 제거해야 합니다. 이는 커넥션 풀링 로직을 포함하여, C3P0 클래스 및 메서드를 사용하는 모든 코드를 말합니다.
- 다른 커넥션 풀링 라이브러리로 전환하려면 해당 라이브러리로 코드를 마이그레이션해야 합니다. 예를 들어, Apache Commons DBCP 또는 HikariCP와 같은 다른 커넥션 풀 라이브러리로 변경할 수 있습니다.
- C3P0가 여전히 필요하다면, `c3p0-0.9.5.5.jar`을 프로젝트의 의존성으로 다시 추가해야 합니다. Maven, Gradle 등의 의존성 관리 도구를 사용하고 있다면, 해당 라이브러리를 `pom.xml`이나 `build.gradle` 파일에 다시 명시해야 합니다.

런타임에 오류를 방지하기 위해서는 통합 테스트를 수행하여 애플리케이션의 모든 부분이 올바르게 작동하는지 확인하는 것이 좋습니다.

## 사용자 입력:
> 위와 같은 런타임오류를 런타임전에 알 수 있는 방법은?

## ChatGPT 응답:
> 런타임 오류, 특히 의존성 관련 오류를 런타임 전에 발견하는 방법은 여러 가지가 있습니다. 다음은 그 중 몇 가지 방법입니다:

1. **단위 테스트 (Unit Testing):**
   단위 테스트를 작성하여 코드의 각 부분이 독립적으로 제대로 작동하는지 확인합니다. 이 테스트들은 의존성이 필요한 코드 경로를 실행하므로, 의존성이 누락되었을 때 오류를 잡아낼 수 있습니다.

2. **통합 테스트 (Integration Testing):**
   통합 테스트는 여러 컴포넌트가 함께 작동하는 것을 테스트하며, 이 과정에서 런타임 의존성도 검증됩니다. 특히, 데이터베이스와 같은 외부 시스템에 대한 통합 테스트는 런타임 의존성 문제를 드러내는 좋은 방법입니다.

3. **의존성 분석 도구 사용:**
   Maven, Gradle 등의 빌드 도구는 종속성을 분석하는 기능을 제공합니다. 예를 들어, Maven의 `dependency:analyze` 명령은 프로젝트의 실제 사용 중인 의존성과 선언된 의존성을 비교하여 사용되지 않거나 누락된 의존성을 보고할 수 있습니다.

4. **코드 분석 도구 사용:**
   정적 코드 분석 도구 (예: SonarQube, FindBugs, Checkstyle)는 코드를 분석하고 잠재적인 문제를 식별할 수 있습니다. 이 도구들은 참조되지만 선언되지 않은 클래스나 메서드 호출을 포착할 수 있습니다.

5. **컨테이너/플랫폼 테스트:**
   애플리케이션을 개발 환경과 동일하거나 유사한 환경에서 테스트하는 것입니다. 예를 들어, 애플리케이션 서버나 컨테이너 (예: Tomcat, JBoss, Docker)에서 애플리케이션을 배포하고 기본적인 기능 테스트를 실행하여 의존성 문제를 확인합니다.

6. **지속적 통합 (Continuous Integration):**
   지속적 통합 시스템은 코드 변경 사항이 커밋될 때마다 빌드를 자동으로 수행하고 테스트를 실행하여 문제를 조기에 발견할 수 있도록 도와줍니다.

7. **런타임 모니터링 도구:**
   APM (Application Performance Management) 도구를 사용하여 런타임 중에 성능 문제, 에러, 로깅 등을 모니터링합니다. 이러한 도구는 실제 운영 환경에서 문제를 조기에 발견하는 데 도움이 될 수 있습니다.

위의 방법들을 통해 코드 변경 후에 발생할 수 있는 의존성 관련 문제를 최대한 미리 감지하고 해결할 수 있습니다.

